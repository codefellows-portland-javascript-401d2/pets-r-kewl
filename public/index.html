<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Welcome to pets</title>
</head>
<body>
	<header>
		<h1>Welcome to Pets!</h1>
	</header>
	
	<main></main>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/superagent/1.2.0/superagent.min.js"></script>
	<script src="js/getToken.js"></script>
	<script src='http://cdn.ractivejs.org/edge/ractive.js'></script>
	<script src="/socket.io/socket.io.js"></script>

	<script>
		function initApp( token ){
			const request = superagent;
			
			const app = new Ractive({
				el: 'main',
				template: '#app',
				oninit() {
					request.get( '/pets' )
						.set( 'token', token )
						.end( ( err, res ) => this.set( 'pets', res.body ) )
				}
			});
			
  			const socket = io();	
		}
		
	</script>
	<script>
		getToken( superagent )
			.then( initApp, err => {
				console.log( err );
				localStorage.removeItem( 'token' );
				window.location = 'login.html';	
			});
	</script>
	
	
	<script id="app" type="text/html">
		<div><a href='login.html' onclick="logout();">log out</a></div>
		<h2>Pets</h2>
		<ul>
			{{#each pets as pet}}
				<li>{{pet.name}} the {{pet.type}}</li>
			{{/each}}
		</ul>
	</script>
	
	
	
</body>
</html>